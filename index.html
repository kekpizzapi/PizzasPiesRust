<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Stream</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.7.11/shaka-player.ui.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.7.11/controls.min.css">
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #0a0a0a;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        .container {
            width: 100%;
            max-width: 1280px;
        }
        #video-container {
            position: relative;
            width: 100%;
            aspect-ratio: 16/9;
            background: #000;
        }
        video {
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="video-container" data-shaka-player-container>
            <video id="video" data-shaka-player autoplay muted></video>
        </div>
    </div>

    <script>
        async function init() {
            // Check if browser is supported
            if (!shaka.Player.isBrowserSupported()) {
                console.error('Browser not supported!');
                return;
            }

            const video = document.getElementById('video');
            const container = document.getElementById('video-container');
            
            const player = new shaka.Player(video);
            const ui = new shaka.ui.Overlay(player, container, video);
            
            // Configure UI
            const config = {
                addSeekBar: true,
                addBigPlayButton: true,
                controlPanelElements: [
                    'play_pause',
                    'time_and_duration',
                    'spacer',
                    'mute',
                    'volume',
                    'fullscreen',
                    'overflow_menu'
                ],
                overflowMenuButtons: ['quality', 'playback_rate'],
            };
            ui.configure(config);

            // Configure player for live streaming
            player.configure({
                streaming: {
                    bufferingGoal: 10,
                    rebufferingGoal: 2,
                    lowLatencyMode: true,
                    inaccurateManifestTolerance: 0,
                    liveSync: {
                        enabled: true,
                        targetLatency: 3,
                        maxPlaybackRate: 1.1,
                        minPlaybackRate: 0.95
                    }
                }
            });

            // Error handling
            player.addEventListener('error', (event) => {
                console.error('Error code', event.detail.code, 'object', event.detail);
            });

            // Load the stream
            try {
                await player.load('https://stream.pizzaspies.pizza/mystream/index.m3u8');
                console.log('Stream loaded successfully!');
            } catch (error) {
                console.error('Error loading stream:', error);
            }
        }

        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
